(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-38",headers:{authorization:"b202a4e8-5e51-4e89-82f0-34fda1db945d","Content-Type":"application/json"}},e=document.querySelector("#card-template").content;function n(t,e,n,r,c,a){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"append",i=o(t,e._id,e.name,e.link,e.likes,e.owner._id,n,r,c);a[u](i)}function o(n,o,r,c,a,u,i,l,s){var p=e.querySelector(".card").cloneNode(!0),d=p.querySelector(".card__image"),f=p.querySelector(".card__title"),_=p.querySelector(".card__delete-button"),y=p.querySelector(".card__like-button"),h=p.querySelector(".card__like-counter");return d.src=c,d.alt=r,f.textContent=r,h.textContent=a.length,u===n?_.addEventListener("click",(function(t){i(t,o)})):_.remove(),function(t,e){return 0!==t.length&&t.some((function(t){if(t._id===e)return!0}))}(a,n)&&l(p),y.addEventListener("click",(function(e){l(p),y.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).catch((function(t){console.log("Ошибка. Запрос не выполнен")}))}(o).then((function(t){h.textContent=t.likes.length})).catch((function(t){console.log("Ошибка. Запрос не выполнен"),l(p)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).catch((function(t){console.log("Ошибка. Запрос не выполнен")}))}(o).then((function(t){h.textContent=t.likes.length})).catch((function(t){console.log("Ошибка. Запрос не выполнен"),l(p)}))})),d.addEventListener("click",(function(t){s(t.target.src,t.target.alt)})),p}function r(e,n){(function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(t){return t.ok?t.ok:Promise.reject("Что-то пошло не так: ".concat(res.status))})).catch((function(t){console.log("Ошибка. Запрос не выполнен")}))})(n).then((function(t){e.target.closest(".card").remove()})).catch((function(t){console.log("Ошибка. Запрос не выполнен")}))}function c(t){t.querySelector(".card__like-button").classList.toggle("card__like-button_is-active")}var a=document.querySelector(".page");function u(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",p)}function i(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",p)}function l(t){t.target.classList.contains("popup")&&i(t.currentTarget)}function s(t){t.target.classList.contains("popup__close")&&i(t.currentTarget)}function p(t){"Escape"===t.key&&i(a.querySelector(".popup_is-opened"))}function d(t,e,n,o){e.classList.remove("".concat(n)),e.textContent="",t.classList.remove("".concat(o)),t.setCustomValidity("")}function f(t,e,n){!function(t){return t.some((function(t){if(!t.validity.valid)return!0}))}(t)?(e.classList.remove("".concat(n)),e.disabled=!1):(e.disabled=!0,e.classList.add("".concat(n)))}function _(t,e){var n=Array.from(t.querySelectorAll(".popup__input")),o=t.querySelector("".concat(e.submitButtonSelector));n.forEach((function(n){d(n,t.querySelector(".".concat(n.id,"-error")),e.errorClass,e.inputErrorClass)})),f(n,o,e.inactiveButtonClass)}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var h,m=document.querySelector(".page"),v=m.querySelector(".places__list"),S=m.querySelector(".popup_type_image"),g=S.querySelector(".popup__image"),b=S.querySelector(".popup__caption"),q=m.querySelector(".profile__image"),C=m.querySelector(".popup_type_avatar-edit"),k=C.querySelector('form[name="avatar-edit-profile"]'),E=k.querySelector(".popup__input_type_url"),L=m.querySelector(".profile__edit-button"),x=m.querySelector(".profile__add-button"),j=m.querySelector(".popup_type_edit"),A=m.querySelector('form[name="edit-profile"]'),P=m.querySelector(".popup_type_new-card"),U=m.querySelector('form[name="new-place"]'),T=Array.from(m.querySelectorAll(".popup")),w=m.querySelector(".profile__title"),O=m.querySelector(".profile__description"),B=m.querySelector(".profile__image"),D=A.querySelector(".popup__input_type_name"),I=A.querySelector(".popup__input_type_description"),M=U.querySelector(".popup__input_type_card-name"),N=U.querySelector(".popup__input_type_url"),J={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};function V(t,e){e.reset(),_(e,J),u(t)}function H(t,e){g.src=t,g.alt=e,b.textContent=e,u(S)}Promise.all([fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(res.status))})).then((function(t){return t})).catch((function(t){console.log("Ошибка. Запрос не выполнен")})),fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(res.status))})).catch((function(t){console.log("Ошибка. Запрос не выполнен")}))]).then((function(t){var e,o,a=(o=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(u.push(o.value),u.length!==e);i=!0);}catch(t){l=!0,r=t}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return u}}(e,o)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}(e,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=a[0],i=a[1];(function(t){w.textContent=t.name,O.textContent=t.about,B.style.backgroundImage="url(".concat(t.avatar,")")})(h=i),u.forEach((function(t){n(h._id,t,r,c,H,v)}))})),T.forEach((function(t){t.addEventListener("click",s),t.addEventListener("click",l)})),q.addEventListener("click",(function(){V(C,k)})),L.addEventListener("click",(function(){D.value=w.textContent,I.value=O.textContent,_(A,J),u(j)})),x.addEventListener("click",(function(){V(P,U)})),C.addEventListener("submit",(function(e){return function(e,n){e.preventDefault();var o,r=e.target.querySelector(".popup__button");r.textContent="Сохранение....",(o=E.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:"".concat(o)})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).catch((function(t){console.log("Ошибка. Запрос не выполнен")}))).then((function(){q.style.backgroundImage="url(".concat(E.value,")"),i(n),r.textContent="Сохранить"})).catch((function(t){console.log(t),r.textContent="Сохранить"}))}(e,C)})),j.addEventListener("submit",(function(e){!function(e,n){e.preventDefault();var o,r,c=e.target.querySelector(".popup__button");c.textContent="Сохранение....",w.textContent=D.value,O.textContent=I.value,o=D.value,r=I.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o,about:r})}).then((function(t){return t.ok?t.ok:Promise.reject("Что-то пошло не так: ".concat(res.status))})).catch((function(t){console.log("Ошибка. Запрос не выполнен")})),c.textContent="Сохранить",i(n)}(e,j)})),P.addEventListener("submit",(function(e){!function(e,o){var a={name:M.value,link:N.value};e.preventDefault();var u,l,s=o.querySelector(".popup__button");s.textContent="Сохранение....",(u=a.name,l=a.link,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:u,link:l})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(res.status))})).catch((function(t){console.log("Ошибка. Запрос не выполнен")}))).then((function(t){n(h._id,t,r,c,H,v,"prepend")})).then((function(){U.reset(),i(o),s.textContent="Сохранить"})).catch((function(t){console.log(t)}))}(e,P)})),function(t){Array.from(document.querySelectorAll("".concat(t.formSelector))).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll("".concat(e.inputSelector))),o=t.querySelector("".concat(e.submitButtonSelector));n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?d(e,o,n.errorClass,n.inputErrorClass):function(t,e,n,o,r){e.textContent=n,e.classList.add("".concat(o)),t.classList.add("".concat(r))}(e,o,e.validationMessage,n.errorClass,n.inputErrorClass)}(t,r,e),f(n,o,e.inactiveButtonClass)}))}))}(e,t)}))}(J)})();